# Стартовая задача по разработке САПР

Ниже формулируется объёмная стартовая задача для внедрения декларативных 3D-моделей/сборок, расчётов прочности и кинематики, а также Vulkan-рендеринга без внешних зависимостей на парсинг YAML и STEP.

## Цели
- Задать единый текстовый формат на YAML для описания деталей, узлов, сборок, нагрузок и сценариев движения.
- Реализовать минималистичный парсер YAML **без внешних библиотек** и валидатор схемы.
- Добавить собственный загрузчик STEP (AP203/AP214) для импорта геометрии, без сторонних библиотек.
- Подготовить внутренние структуры данных для кинематических/динамических расчётов и прочностного анализа.
- Включить построение пользовательских моделей на основе геометрических примитивов с булевыми операциями (объединение/пересечение/вычитание), каждая модель описывается отдельным YAML-файлом.
- Поддержать использование эскизов (загружаемых или inline) как источник геометрии; предусмотреть дальнейшую процедурную генерацию профилей (например, эвольвенты зубьев).
- Расширить существующий Vulkan-конвейер под 3D-рендеринг деталей/сборок и визуализацию результатов расчётов.

## Объём работ
1. **Формат YAML**
   - Описать схему YAML: `parts`, `joints`, `assemblies`, `analysis`, `motion`, `materials`.
   - Для каждой пользовательской модели отдельный YAML с описанием геометрии через примитивы и булевы операции (`difference`, `union`, `intersection`) или через эскиз/процедурное построение.
   - Задать обязательные поля (id, типы соединений, ограничения, материалы, траектории приводов) и опциональные (метаданные, конфигурации сборок).
   - Подготовить 2–3 эталонных YAML-сценария (простая шарнирная пара, редуктор, статический упор).

2. **Парсер YAML без зависимостей**
   - Реализовать лексер и рекурсивный спуск: поддержка скаляров, списков, словарей, якорей можно опустить.
   - Добавить нормализатор путей/единиц измерения, сообщения об ошибках с позицией.
   - Интегрировать в существующий код-стиль проекта (C) и выдать API `parse_scene_yaml(const char* path, Scene* out)`.

3. **Загрузчик STEP (без сторонних библиотек)**
   - Поддержать базовые сущности AP203/AP214: CARTESIAN_POINT, DIRECTION, AXIS2_PLACEMENT_3D, EDGE_CURVE, ADVANCED_FACE, SHELL/BREP.
   - Построить треугольные меши (плоская дискретизация) для рендеринга и расчётов.
   - Добавить вычисление AABB/массовых свойств (заданная плотность материала).

4. **Данные для анализа и кинематики**
   - Внутренние структуры: `Part`, `Joint` (revolute/prismatic/fixed), `AssemblyNode`, `LoadCase`, `Material`, `MotionProfile`.
   - API для подготовки кинематической модели и статического решателя (заглушки допустимы, но интерфейсы должны быть стабильны).
   - Представления эскизов (кривые, контуры), примитивов (box/cylinder/sphere/extrude) и булевых деревьев для построения геометрии моделей.

5. **Рендеринг (Vulkan)**
   - Расширить пайплайн: загрузка мешей из STEP, PBR/flat шейдеры, отображение траекторий и сил (линиями/стрелками), простая камера.
   - Добавить минимальный UI-оверлей (используя существующий UI стек) для выбора сценариев и отображения результатов.

6. **CLI/скрипты и тесты**
   - Командная утилита: `app --scene scene.yaml --run analysis|motion --frames 100 --out report.json`.
   - Юнит-тесты: парсинг YAML (валидные/ошибочные файлы), загрузка простого STEP, базовый кинематический прогон.

## Критерии приёмки
- Репозиторий собирается без внешних зависимостей для YAML и STEP.
- Минимум два демонстрационных сцена-файла YAML + один STEP-образец рендерятся и валидируются тестами.
- CLI успешно запускает сценарий движения и статический расчёт (можно возвращать заглушечные численные результаты, но структура отчёта фиксирована).
- Код снабжён комментариями и README-блоком с инструкцией запуска.

## Ограничения и рекомендации
- Не использовать сторонние парсеры YAML/STEP; допускаются лишь стандартные заголовки C/C++ и уже присутствующие зависимости проекта.
- Поддерживать модульность: парсер YAML и загрузчик STEP как отдельные модули с чётким API.
- Сосредоточиться на простоте и читабельности кода; избегать избыточного метапрограммирования и исключений.
