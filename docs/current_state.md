# Состояние проекта "Graphics"
**Дата:** 16 Декабря 2025
**Версия:** Alpha (Prototype)

## 1. Архитектурный обзор
Проект построен на языке C (C11) с использованием архитектурного паттерна **MVVM-C** (Model-View-ViewModel-Controller), адаптированного для процедурного программирования.

### Основные подсистемы:
1.  **Foundation:** Базовые сервисы (логгер, файловая система, математика векторов/матриц, рефлексия).
2.  **Engine (Core):**
    *   **Assets:** Управление ресурсами (шейдеры, шрифты).
    *   **UI:** Собственная система интерфейса (Retained Mode, Flexbox-like layout).
    *   **Render:** Абстрагированный рендерер (текущий бэкенд: Vulkan/DZN), работающий в отдельном потоке.
3.  **Domains (Logic):**
    *   **Math Model:** Граф математических функций.
    *   **CAD Model:** Представление геометрических данных (Mesh).

---

## 2. Детальный разбор подсистем

### A. Math Engine (MathGraph)
*   **Структура:** Направленный граф (DAG). Узлы (`MathNode`) содержат операцию (Add, Mul, Sin) и ссылки на входные узлы.
*   **Данные:** Оперирует исключительно скалярными значениями `float`.
*   **Исполнение:** Рекурсивный обход графа на CPU (`math_node_eval`).
*   **Визуализация:**
    *   Реализован `MathMeshBuilder` для построения поверхностей.
    *   **Критическая проблема:** Генерация меша происходит на CPU. Для сетки $N \times M$ граф вычисляется $N \times M$ раз *каждый кадр*. Это блокирует основной поток и не масштабируется.

### B. Render System
*   **Архитектура:** Data-Driven. Основной поток формирует `RenderPacket` (копии данных), поток рендера потребляет их.
*   **Синхронизация:** Double Buffering пакетов.
*   **Backend:** Vulkan (через слой абстракции). Поддерживает загрузку SPIR-V шейдеров.
*   **Отрисовка UI:** Отдельный проход, генерирующий вершинный буфер для UI-элементов.

### C. UI System
*   **Определение:** Декларативное описание в YAML (`assets/ui/*.yaml`).
*   **Layout:** Flexbox-подобный (Row/Column, Padding, Spacing).
*   **Binding:** Привязка данных через Reflection (строковые пути `{value}`).
*   **Input:** Реализована базовая поддержка мыши (Click, Drag для слайдеров).
*   **Ограничения:** Отсутствует поддержка кастомной отрисовки (Canvas), скроллинга областей, зума и визуальных редакторов.

---

## 3. Ключевые проблемы (Bottlenecks)

1.  **CPU-Bound Math:** Вычисление математики на процессоре делает невозможным работу с плотными сетками или сложными функциями в реальном времени.
2.  **Scalar-Only:** Отсутствие поддержки векторов и матриц в графе ограничивает математические возможности (нет линейной алгебры).
3.  **Static UI:** Текущая система UI не позволяет создать Node Editor (редактор графов), так как нет примитивов для рисования линий/кривых и управления свободным пространством (Pan/Zoom).
4.  **Data Transfer:** Передача сгенерированной геометрии (Mesh) каждый кадр с CPU на GPU является узким местом шины.

## 4. Итог
Проект имеет надежный, чистый фундамент (Memory Management, Reflection, Render Threading), но математическое ядро требует полной переработки архитектуры исполнения (перенос на GPU) для достижения заявленных целей "Grand Math Engine".