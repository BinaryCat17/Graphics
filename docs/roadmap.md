# üó∫Ô∏è Roadmap: "–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–∞—è –°—Ç—Ä–æ–π–Ω–æ—Å—Ç—å" (v4.0)

**–¶–µ–ª—å:** –ü—Ä–µ–≤—Ä–∞—Ç–∏—Ç—å –ø—Ä–æ–µ–∫—Ç –∏–∑ –º–æ–Ω–æ–ª–∏—Ç–Ω–æ–≥–æ C-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ –º–æ–¥—É–ª—å–Ω—ã–π –¥–≤–∏–∂–æ–∫, —É–ø—Ä–∞–≤–ª—è–µ–º—ã–π –¥–∞–Ω–Ω—ã–º–∏.

## üèóÔ∏è Phase 1: –°—Ç—Ä–æ–≥–∞—è –ú–æ–¥—É–ª—å–Ω–æ—Å—Ç—å (The Facade Pattern)
*–¶–µ–ª—å: –§–∏–∑–∏—á–µ—Å–∫–∏ —Ä–∞–∑–¥–µ–ª–∏—Ç—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é.*

- [x] **–†–µ—Å—Ç—Ä—É–∫—Ç—É—Ä–∏–∑–∞—Ü–∏—è `src/engine/graphics`**
    - [x] **Flattening:** –§–∞–π–ª—ã —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ (`stream.c`, `gpu_input.c`, `compute_graph.c`) –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ –∫–æ—Ä–Ω–µ –º–æ–¥—É–ª—è.
    - [x] **Internal:**
        - [x] `internal/backend/` ‚Äî –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –±—ç–∫–µ–Ω–¥ (Vulkan).
        - [x] `internal/render_system_internal.h` ‚Äî —Å–∫—Ä—ã—Ç–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è RenderSystem.
        - [x] `internal/stream_internal.h` ‚Äî –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–æ–Ω—Ç—Ä–∞–∫—Ç –º–µ–∂–¥—É Stream –∏ Backend.
    - [x] **Cleanup:** –°–æ–∑–¥–∞–Ω—ã `graphics_types.h` –∏ –≤—ã–¥–µ–ª–µ–Ω `gpu_input.h`. –£–¥–∞–ª–µ–Ω—ã —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ —Ö–µ–¥–µ—Ä—ã (`layer_constants.h`, `render_batch.h`).
- [ ] **–†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ `engine/assets`**
    - [ ] –†–∞–∑–±–∏—Ç—å `assets.c` –Ω–∞ —Ñ–∞—Å–∞–¥ (–≤ –∫–æ—Ä–Ω–µ) –∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é:
        - [ ] –ó–∞–≥—Ä—É–∑–∫–∞: `internal/asset_loader.c`
        - [ ] –•—Ä–∞–Ω–µ–Ω–∏–µ: `internal/asset_storage.c`
- [x] **–í–Ω–µ–¥—Ä–µ–Ω–∏–µ Opaque Pointers (PIMPL)**
    - [x] –í –ø—É–±–ª–∏—á–Ω—ã—Ö —Ö–µ–¥–µ—Ä–∞—Ö (`render_system.h`) –æ—Å—Ç–∞–ª–∏—Å—å —Ç–æ–ª—å–∫–æ typedefs.
    - [x] –ü–æ–ª–Ω–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–æ –≤ `internal/render_system_internal.h`.

## üîå Phase 2: –†–∞–∑—Ä—ã–≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (Decoupling)
*–¶–µ–ª—å: –†–µ–Ω–¥–µ—Ä –Ω–µ –¥–æ–ª–∂–µ–Ω –∑–Ω–∞—Ç—å –ø—Ä–æ UI, –∞ –Ø–¥—Ä–æ –ø—Ä–æ –ú–∞—Ç–µ–º–∞—Ç–∏–∫—É.*

- [ ] **Render Agnosticism (–ù–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å —Ä–µ–Ω–¥–µ—Ä–∞)**
    - [ ] –£–¥–∞–ª–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å `render_system` –æ—Ç `ui_node.h`.
    - [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–π —Å–ª–æ–π `RenderBatchList` / `DrawCommandList`.
    - [ ] **–ó–∞–¥–∞—á–∞:** –ú–æ–¥—É–ª—å UI –¥–æ–ª–∂–µ–Ω —Å–∞–º –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Å–ø–∏—Å–æ–∫ –∫–æ–º–∞–Ω–¥. –†–µ–Ω–¥–µ—Ä —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è "—Ç—É–ø—ã–º" –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–º.
- [ ] **Feature System (Plugin Architecture)**
    - [ ] –í–≤–µ—Å—Ç–∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å `EngineFeature` (–º–µ—Ç–æ–¥—ã `on_init`, `on_update`, `on_extract`).
    - [ ] –£–¥–∞–ª–∏—Ç—å –ø—Ä—è–º–æ–π –∏–Ω–∫–ª—é–¥ `math_editor.h` –∏–∑ `engine.c`.
    - [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫—É—é —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é `MathEditor` –≤ `main.c` –∫–∞–∫ –ø–ª–∞–≥–∏–Ω–∞.

## üìú Phase 3: –î–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω–æ–µ –Ø–¥—Ä–æ (Data-Driven Core)
*–¶–µ–ª—å: –ó–∞–º–µ–Ω–∏—Ç—å —Ö–∞—Ä–¥–∫–æ–¥ –≤ `main.c` –Ω–∞ –∑–∞–≥—Ä—É–∑–∫—É –≥—Ä–∞—Ñ–∞.*

- [ ] **–°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è `.gdl` (Graph Definition Language)**
    - [ ] –†–∞–∑—Ä–∞–±–æ—Ç–∞—Ç—å YAML-—Ñ–æ—Ä–º–∞—Ç –¥–ª—è –æ–ø–∏—Å–∞–Ω–∏—è **Macro Graph** (–ø–∞–π–ø–ª–∞–π–Ω–∞ –∫–∞–¥—Ä–∞).
    - [ ] –ü—Ä–∏–º–µ—Ä —Å—Ç—Ä—É–∫—Ç—É—Ä—ã:
      ```yaml
      pipeline:
        - pass: "ComputePhysics"
          system: "MathGraph"
        - pass: "RenderScene"
        - pass: "RenderUI"
      ```
- [ ] **Pipeline Loader**
    - [ ] –ù–∞–ø–∏—Å–∞—Ç—å –ø–∞—Ä—Å–µ—Ä, —á–∏—Ç–∞—é—â–∏–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ.
    - [ ] –ü–µ—Ä–µ–ø–∏—Å–∞—Ç—å —Ü–∏–∫–ª `engine_run`: –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ —à–∞–≥–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–≥–æ –ø–∞–π–ø–ª–∞–π–Ω–∞ –≤–º–µ—Å—Ç–æ –∂–µ—Å—Ç–∫–æ–π –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏.

## üßπ Phase 4: –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –î–æ–ª–≥ –ë—ç–∫–µ–Ω–¥–∞
*–¶–µ–ª—å: –°–¥–µ–ª–∞—Ç—å Vulkan-–±—ç–∫–µ–Ω–¥ —á–∏—â–µ.*

- [ ] **Dynamic Descriptor Layouts**
    - [ ] –£–±—Ä–∞—Ç—å –∂–µ—Å—Ç–∫–æ –∑–∞—à–∏—Ç—ã–µ –∏–Ω–¥–µ–∫—Å—ã —Å–µ—Ç–æ–≤ (Set 0, Set 1) –≤ `vk_pipeline.c`.
    - [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ –ª–µ–π–∞—É—Ç–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–µ—Ñ–ª–µ–∫—Å–∏–∏ —à–µ–π–¥–µ—Ä–æ–≤ –∏–ª–∏ GDL.
- [ ] **Buffer Management**
    - [ ] –ó–∞–≤–µ—Ä—à–∏—Ç—å –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ `Stream` –∫–∞–∫ –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π —Å–ø–æ—Å–æ–± —Ä–∞–±–æ—Ç—ã —Å –±—É—Ñ–µ—Ä–∞–º–∏.
    - [ ] –£–¥–∞–ª–∏—Ç—å —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ –≤—ã–∑–æ–≤—ã `vk_buffer_create` –∏–∑ –ª–æ–≥–∏–∫–∏ —Å—Ü–µ–Ω—ã.
    